# podman kube --help
# man podman-kube-play
# cd deployment/play # this is important so the image build works
# podman kube play --replace keycloak.yaml
# podman logs keycloak-keycloak
# https://github.com/containers/podman/blob/main/docs/kubernetes_support.md?plain=1
# podman stats
apiVersion: v1
kind: Pod
metadata:
  name: keycloak
spec:
  containers:
    - name: keycloak
      image: keycloak
      args: ["start", "--optimized"]
      env:
        - name: KC_DB_URL
          value: jdbc:postgresql://postgres/postgres
        - name: KC_DB_USERNAME
          value: postgres
        - name: KC_DB_PASSWORD
          value: bestpassword # FIXME don't put password here
        - name: KC_HOSTNAME
          value: localhost
        # https://www.keycloak.org/server/enabletls
        # TODO https://www.keycloak.org/server/vault
        - name: KC_HTTPS_CERTIFICATE_FILE
          value: test
        - name: KC_HTTPS_CERTIFICATE_KEY_FILE
          value: test
      volumeMounts:
        - name: keycloak-tls-cert-volume
          mountPath: "/etc/tls-cert"
          readOnly: true
        - name: keycloak-tls-key-volume
          mountPath: "/etc/tls-key"
          readOnly: true
      ports:
        - containerPort: 8443
      resources:
        requests:
          memory: "512Mi"
          cpu: "1"
        limits:
          memory: "1Gi"
          cpu: "4"
  volumes:
    - name: keycloak-tls-cert-volume
      secret:
        secretName: keycloak-tls-cert
    - name: keycloak-tls-key-volume
      secret:
        secretName: keycloak-tls-key
---
# mkcert keycloak.localhost
# podman secret create keycloak-tls-cert keycloak.localhost.pem
# podman secret create keycloak-tls-key keycloak.localhost-key.pem
